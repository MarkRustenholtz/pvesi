<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>PV ESI</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#003366">
  <link rel="apple-touch-icon" href="icon-192.png">
  <link rel="icon" href="icon-192.png">
  <link rel="stylesheet" href="pv.css">
</head>
<body>
  <header class="header">PV ESI — Application</header>

  <section id="homePage" class="page active">
    <div class="container card">
      <h2>Bienvenue</h2>
      <p>Crée un nouveau PV ou charge le dernier enregistré.</p>
      <div class="actions">
        <button class="primary" onclick="PVApp.newPV()">Nouveau PV</button>
        <button class="outline" onclick="PVApp.loadPV()">Charger le dernier</button>
        <button class="danger" onclick="PVApp.clearAll()">Effacer sauvegarde</button>
      </div>
    </div>
  </section>

  <section id="showPage" class="page">
    <div class="container card">
      <h3>Champs (formulaire)</h3>
      <div class="grid">
        <fieldset>
          <legend>Rédacteur (APJA)</legend>
          <div class="row">
            <label>Grade</label><input id="frm_agent_grade" placeholder="Gendarme / GND / MDL"/>
          </div>
          <div class="row">
            <label>Nom</label><input id="frm_agent_nom" placeholder="DURAND"/>
          </div>
          <div class="row">
            <label>Prénom</label><input id="frm_agent_prenom" placeholder="Pierre"/>
          </div>
          <div class="row">
            <label>Unité</label><input id="frm_agent_unite" placeholder="CRT 06/1 Nice"/>
          </div>
          <div class="row">
            <label>Sexe</label>
            <select id="frm_agent_sexe">
              <option value="M">Masculin</option>
              <option value="F">Féminin</option>
            </select>
          </div>
        </fieldset>

        <fieldset>
          <legend>Contexte</legend>
          <div class="row"><label>Année (texte)</label><input id="frm_annee" value="deux mil vingt-cinq"/></div>
          <div class="row"><label>Date (texte)</label><input id="frm_date_txt" value="17 Juillet"/></div>
          <div class="row"><label>Heure (texte)</label><input id="frm_heure_txt" value="16 heures et 25 minutes"/></div>
          <div class="row"><label>PPA (lieu)</label><input id="frm_ppa" value="la Turbie"/></div>
          <div class="row"><label>Plage horaire</label><input id="frm_plage" value="15 heures à 23 heures"/></div>
          <div class="row"><label>Chef Service</label><input id="frm_chef" value="Emmanuelle JOUBERT"/></div>
        </fieldset>

        <fieldset>
          <legend>Bus (si applicable)</legend>
          <div class="row"><label>Heure constat</label><input id="frm_bus_heure" value="16 heures et 30 minutes"/></div>
          <div class="row"><label>Compagnie</label><input id="frm_bus_cie" value="FLIXBUS"/></div>
          <div class="row"><label>Pays immat.</label><input id="frm_bus_pays" value="Italie"/></div>
          <div class="row"><label>Immat.</label><input id="frm_bus_immat" value="GT-503-RE"/></div>
          <div class="row"><label>Origine</label><input id="frm_bus_orig" value="Turin (Italie)"/></div>
          <div class="row"><label>Destination</label><input id="frm_bus_dest" value="Nice (France)"/></div>
        </fieldset>
      </div>

      <fieldset id="assistBlock">
        <legend>Assistants (illimité)</legend>
        <div id="assistList"></div>
        <button type="button" class="small" onclick="PVApp.addAssistant()">+ Ajouter un assistant</button>
      </fieldset>

      <fieldset id="esiBlock">
        <legend>ESI (personnes contrôlées/interpellées) — illimité</legend>
        <div id="esiList"></div>
        <button type="button" class="small" onclick="PVApp.addEsi()">+ Ajouter un ESI</button>
      </fieldset>

      <div class="actions">
        <button class="primary" onclick="PVApp.generate()">Générer le PV</button>
        <button class="success" onclick="PVApp.save()">💾 Sauvegarder</button>
        <button class="outline" onclick="PVApp.print()">🖨️ Imprimer</button>
        <button onclick="PVApp.back()">⬅️ Retour</button>
      </div>
    </div>

    <div class="pv-wrapper">
      <div id="sheet" class="pv-page"></div>
    </div>

    <div class="sticky-actions">
      <button class="success" onclick="PVApp.save()">💾 Sauvegarder</button>
      <button class="outline" onclick="PVApp.print()">🖨️ Imprimer</button>
    </div>
  </section>

  <script src="pv.js"></script>
  <script>
    if('serviceWorker' in navigator){ addEventListener('load',()=>navigator.serviceWorker.register('./sw.js')); }
  </script>
</body>
</html>
